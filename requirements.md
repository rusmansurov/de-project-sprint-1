# Витрина RFM

## 1 Требования к целевой витрине.

Необходимо создать витрину данных для RFM-классификации пользователей приложения со следующими критериями:
1. В витрине нужны данные с начала 2022 года.
1. Обновления не нужны.

### Что такое RFM:
RFM (от англ. Recency, Frequency, Monetary Value) — способ сегментации клиентов, при котором анализируют их лояльность: как часто, на какие суммы и когда в последний раз тот или иной клиент покупал что-то. На основе этого выбирают клиентские категории, на которые стоит направить маркетинговые усилия.
Каждого клиента оценивают по трём факторам:
Recency (пер. «давность») — сколько времени прошло с момента последнего заказа.
Frequency (пер. «частота») — количество заказов.
Monetary Value (пер. «денежная ценность») — сумма затрат клиента.


### Как провести RFM-сегментацию
Фактор Recency измеряется по последнему заказу. Распределить клиентов по шкале от одного до пяти, где значение 1 получат те, кто либо вообще не делал заказов, либо делал их очень давно, а 5 — те, кто заказывал относительно недавно.
Фактор Frequency оценивается по количеству заказов. Распределить клиентов по шкале от одного до пяти, где значение 1 получат клиенты с наименьшим количеством заказов, а 5 — с наибольшим.
Фактор Monetary Value оценивается по потраченной сумме. Распределить клиентов по шкале от одного до пяти, где значение 1 получат клиенты с наименьшей суммой, а 5 — с наибольшей.
Проверить, что количество клиентов в каждом сегменте одинаково. Например, если в базе всего 100 клиентов, то 20 клиентов должны получить значение 1, ещё 20 — значение 2 и т. д.



## 2 Техническая реализация.

1.1 В схеме production содержатся оперативные таблицы.
Необходимо сделать представления для таблиц production в схеме analysis. Все данные для постройки витрины должны браться из этих представлений.

1.2 Таблица-источник для постройки витрины production.orders.
Поля необходимые для расчетов показателей:
- "order_id" 
- "order_ts"
- "user_id"
- "payment"

Важно: необходимо выбирать данные с начала 2022 года и "status" = 4 (это статус Closed и более подробно с этим можно ознакомиться в документе data_quality.md).
При расчете витрины обращаться только к объектам из схемы analysis. Чтобы не дублировать данные (данные находятся в этой же базе), вы решаете сделать view. Таким образом, View будут находиться в схеме analysis и вычитывать данные из схемы production. 


---

База данных *PostgreSQL*:
- база данных: **de**
- логин: jovyan
- пароль: jovyan
- порт: 5432
